<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vue3 - ç”Ÿå‘½å‘¨æœŸä¸ç»„ä»¶é€šä¿¡</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 30px;
            text-align: center;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        h2 {
            color: #667eea;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }
        .lifecycle-demo {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .lifecycle-box {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: #f9f9f9;
        }
        .lifecycle-box h3 {
            color: #764ba2;
            margin-bottom: 10px;
        }
        .log-container {
            background: #2d2d2d;
            color: #00ff00;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 200px;
            overflow-y: auto;
        }
        .log-entry {
            margin: 5px 0;
            padding: 3px;
        }
        .log-entry.mount { color: #4caf50; }
        .log-entry.update { color: #ffc107; }
        .log-entry.unmount { color: #f44336; }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
            transition: transform 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        input {
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            width: 100%;
            margin: 5px 0;
        }
        input:focus {
            outline: none;
            border-color: #667eea;
        }
        .component-box {
            border: 2px dashed #667eea;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            background: linear-gradient(135deg, #667eea10 0%, #764ba210 100%);
        }
        .parent-component {
            border-color: #f093fb;
            background: linear-gradient(135deg, #f093fb10 0%, #f5576c10 100%);
        }
        .child-component {
            border-color: #667eea;
        }
        .emit-log {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 10px;
            margin: 10px 0;
            color: #856404;
        }
        .ref-demo {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .ref-box {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: #f5f5f5;
        }
        .exposed-data {
            background: #e8f5e9;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: monospace;
        }
        .provide-inject-demo {
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        }
        .tree-structure {
            margin: 20px 0;
            padding: 15px;
            background: white;
            border-radius: 8px;
        }
        .tree-node {
            margin-left: 20px;
            padding: 10px;
            border-left: 2px solid #ccc;
            position: relative;
        }
        .tree-node::before {
            content: "";
            position: absolute;
            left: -2px;
            top: 50%;
            width: 10px;
            height: 2px;
            background: #ccc;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="container">
            <h1>ğŸš€ Vue3 ç”Ÿå‘½å‘¨æœŸä¸ç»„ä»¶é€šä¿¡</h1>
            
            <!-- ç”Ÿå‘½å‘¨æœŸå‡½æ•°æ¼”ç¤º -->
            <div class="section">
                <h2>â° ç»„åˆå¼APIç”Ÿå‘½å‘¨æœŸå‡½æ•°</h2>
                
                <div class="lifecycle-demo">
                    <div class="lifecycle-box">
                        <h3>ç”Ÿå‘½å‘¨æœŸæ§åˆ¶</h3>
                        <button @click="toggleComponent">{{ showLifecycleDemo ? 'é”€æ¯' : 'åˆ›å»º' }}ç»„ä»¶</button>
                        <button @click="updateData" :disabled="!showLifecycleDemo">æ›´æ–°æ•°æ®</button>
                        <button @click="clearLogs">æ¸…ç©ºæ—¥å¿—</button>
                        
                        <div v-if="showLifecycleDemo">
                            <lifecycle-demo 
                                :count="lifecycleCount"
                                @log="addLifecycleLog">
                            </lifecycle-demo>
                        </div>
                    </div>
                    
                    <div class="lifecycle-box">
                        <h3>ç”Ÿå‘½å‘¨æœŸæ—¥å¿—</h3>
                        <div class="log-container">
                            <div v-for="(log, index) in lifecycleLogs" 
                                 :key="index" 
                                 :class="['log-entry', log.type]">
                                {{ log.time }} - {{ log.message }}
                            </div>
                            <div v-if="lifecycleLogs.length === 0" style="color: #666;">
                                ç­‰å¾…ç”Ÿå‘½å‘¨æœŸäº‹ä»¶...
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- çˆ¶å­ç»„ä»¶é€šä¿¡ -->
            <div class="section">
                <h2>ğŸ‘¨â€ğŸ‘§ çˆ¶å­ç»„ä»¶é€šä¿¡</h2>
                
                <div class="component-box parent-component">
                    <h3>ğŸ¯ çˆ¶ç»„ä»¶</h3>
                    <p>çˆ¶ç»„ä»¶æ•°æ®ï¼š{{ parentMessage }}</p>
                    <input v-model="parentMessage" placeholder="ä¿®æ”¹çˆ¶ç»„ä»¶æ¶ˆæ¯">
                    
                    <div class="emit-log" v-if="childEmitData">
                        ğŸ“¨ æ¥æ”¶åˆ°å­ç»„ä»¶æ¶ˆæ¯ï¼š{{ childEmitData }}
                    </div>
                    
                    <child-component 
                        :parent-msg="parentMessage"
                        :count="parentCount"
                        @update-parent="handleChildUpdate"
                        @increment="parentCount++">
                    </child-component>
                </div>
            </div>
            
            <!-- æ¨¡æ¿å¼•ç”¨ä¸ defineExpose -->
            <div class="section">
                <h2>ğŸ¯ æ¨¡æ¿å¼•ç”¨ä¸ defineExpose</h2>
                
                <div class="ref-demo">
                    <div class="ref-box">
                        <h3>DOM å…ƒç´ å¼•ç”¨</h3>
                        <input ref="inputRef" placeholder="æˆ‘æ˜¯ä¸€ä¸ªè¾“å…¥æ¡†">
                        <button @click="focusInput">èšç„¦è¾“å…¥æ¡†</button>
                        <button @click="getInputValue">è·å–è¾“å…¥å€¼</button>
                        <div v-if="inputValue" class="exposed-data">
                            è¾“å…¥æ¡†çš„å€¼ï¼š{{ inputValue }}
                        </div>
                    </div>
                    
                    <div class="ref-box">
                        <h3>ç»„ä»¶å®ä¾‹å¼•ç”¨</h3>
                        <expose-demo ref="exposeRef"></expose-demo>
                        <button @click="callExposedMethod">è°ƒç”¨æš´éœ²æ–¹æ³•</button>
                        <button @click="getExposedData">è·å–æš´éœ²æ•°æ®</button>
                        <div v-if="exposedData" class="exposed-data">
                            æš´éœ²çš„æ•°æ®ï¼š{{ exposedData }}
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- TODO(human): åœ¨è¿™é‡Œæ·»åŠ  provide/inject è·¨å±‚é€šä¿¡çš„ç¤ºä¾‹ -->
            
        </div>
    </div>
    
    <script>
        const { createApp, ref, reactive, onMounted, onUpdated, onUnmounted, watch, provide, inject } = Vue;
        
        // ç”Ÿå‘½å‘¨æœŸæ¼”ç¤ºç»„ä»¶
        const LifecycleDemo = {
            props: ['count'],
            emits: ['log'],
            setup(props, { emit }) {
                const internalData = ref('åˆå§‹æ•°æ®');
                
                // ç”Ÿå‘½å‘¨æœŸé’©å­
                onMounted(() => {
                    emit('log', { 
                        type: 'mount', 
                        message: 'âœ… onMounted - ç»„ä»¶å·²æŒ‚è½½',
                        time: new Date().toLocaleTimeString()
                    });
                });
                
                onUpdated(() => {
                    emit('log', { 
                        type: 'update', 
                        message: 'ğŸ”„ onUpdated - ç»„ä»¶å·²æ›´æ–°',
                        time: new Date().toLocaleTimeString()
                    });
                });
                
                onUnmounted(() => {
                    console.log('ç»„ä»¶å³å°†å¸è½½');
                });
                
                // Watch props å˜åŒ–
                watch(() => props.count, (newVal, oldVal) => {
                    emit('log', { 
                        type: 'update', 
                        message: `ğŸ“Š Watch: count ä» ${oldVal} å˜ä¸º ${newVal}`,
                        time: new Date().toLocaleTimeString()
                    });
                });
                
                return {
                    internalData
                };
            },
            template: `
                <div style="padding: 15px; background: #e8f5e9; border-radius: 8px;">
                    <h4>ç”Ÿå‘½å‘¨æœŸç»„ä»¶</h4>
                    <p>Props count: {{ count }}</p>
                    <p>å†…éƒ¨æ•°æ®: {{ internalData }}</p>
                </div>
            `
        };
        
        // å­ç»„ä»¶
        const ChildComponent = {
            props: ['parentMsg', 'count'],
            emits: ['update-parent', 'increment'],
            setup(props, { emit }) {
                const childMessage = ref('æˆ‘æ˜¯å­ç»„ä»¶');
                
                const sendToParent = () => {
                    emit('update-parent', `å­ç»„ä»¶æ¶ˆæ¯ - ${new Date().toLocaleTimeString()}`);
                };
                
                return {
                    childMessage,
                    sendToParent
                };
            },
            template: `
                <div class="component-box child-component">
                    <h3>ğŸ‘¶ å­ç»„ä»¶</h3>
                    <p>æ¥æ”¶åˆ°çˆ¶ç»„ä»¶æ¶ˆæ¯ï¼š{{ parentMsg }}</p>
                    <p>æ¥æ”¶åˆ°è®¡æ•°ï¼š{{ count }}</p>
                    <p>{{ childMessage }}</p>
                    <button @click="sendToParent">å‘é€æ¶ˆæ¯ç»™çˆ¶ç»„ä»¶</button>
                    <button @click="$emit('increment')">å¢åŠ çˆ¶ç»„ä»¶è®¡æ•°</button>
                </div>
            `
        };
        
        // defineExpose æ¼”ç¤ºç»„ä»¶
        const ExposeDemo = {
            setup() {
                const privateData = ref('è¿™æ˜¯ç§æœ‰æ•°æ®');
                const exposedData = ref('è¿™æ˜¯æš´éœ²çš„æ•°æ®');
                const exposedCount = ref(0);
                
                const exposedMethod = () => {
                    exposedCount.value++;
                    alert(`æš´éœ²çš„æ–¹æ³•è¢«è°ƒç”¨äº† ${exposedCount.value} æ¬¡`);
                    return `è°ƒç”¨æ¬¡æ•°ï¼š${exposedCount.value}`;
                };
                
                // ä½¿ç”¨ç»„åˆå¼APIæ–¹å¼æš´éœ²
                return {
                    // åªæš´éœ²ç‰¹å®šçš„æ•°æ®å’Œæ–¹æ³•
                    exposedData,
                    exposedMethod,
                    exposedCount
                };
            },
            template: `
                <div style="padding: 15px; background: #f0f0f0; border-radius: 8px;">
                    <h4>ç»„ä»¶å®ä¾‹ï¼ˆdefineExposeç¤ºä¾‹ï¼‰</h4>
                    <p>æš´éœ²çš„æ•°æ®ï¼š{{ exposedData }}</p>
                    <p>è°ƒç”¨æ¬¡æ•°ï¼š{{ exposedCount }}</p>
                </div>
            `
        };
        
        // åˆ›å»ºåº”ç”¨
        const app = createApp({
            components: {
                LifecycleDemo,
                ChildComponent,
                ExposeDemo
            },
            setup() {
                // ç”Ÿå‘½å‘¨æœŸç›¸å…³
                const showLifecycleDemo = ref(false);
                const lifecycleCount = ref(0);
                const lifecycleLogs = ref([]);
                
                const toggleComponent = () => {
                    showLifecycleDemo.value = !showLifecycleDemo.value;
                    if (!showLifecycleDemo.value) {
                        lifecycleLogs.value.push({
                            type: 'unmount',
                            message: 'âŒ Component Unmounted - ç»„ä»¶å·²å¸è½½',
                            time: new Date().toLocaleTimeString()
                        });
                    }
                };
                
                const updateData = () => {
                    lifecycleCount.value++;
                };
                
                const clearLogs = () => {
                    lifecycleLogs.value = [];
                };
                
                const addLifecycleLog = (log) => {
                    lifecycleLogs.value.push(log);
                };
                
                // çˆ¶å­ç»„ä»¶é€šä¿¡
                const parentMessage = ref('Hello from Parent');
                const parentCount = ref(0);
                const childEmitData = ref('');
                
                const handleChildUpdate = (data) => {
                    childEmitData.value = data;
                };
                
                // æ¨¡æ¿å¼•ç”¨
                const inputRef = ref(null);
                const exposeRef = ref(null);
                const inputValue = ref('');
                const exposedData = ref('');
                
                const focusInput = () => {
                    if (inputRef.value) {
                        inputRef.value.focus();
                    }
                };
                
                const getInputValue = () => {
                    if (inputRef.value) {
                        inputValue.value = inputRef.value.value;
                    }
                };
                
                const callExposedMethod = () => {
                    if (exposeRef.value) {
                        const result = exposeRef.value.exposedMethod();
                        console.log('æ–¹æ³•è¿”å›å€¼ï¼š', result);
                    }
                };
                
                const getExposedData = () => {
                    if (exposeRef.value) {
                        exposedData.value = exposeRef.value.exposedData;
                    }
                };
                
                // ç”Ÿå‘½å‘¨æœŸ
                onMounted(() => {
                    console.log('App mounted');
                });
                
                return {
                    // ç”Ÿå‘½å‘¨æœŸ
                    showLifecycleDemo,
                    lifecycleCount,
                    lifecycleLogs,
                    toggleComponent,
                    updateData,
                    clearLogs,
                    addLifecycleLog,
                    
                    // çˆ¶å­é€šä¿¡
                    parentMessage,
                    parentCount,
                    childEmitData,
                    handleChildUpdate,
                    
                    // æ¨¡æ¿å¼•ç”¨
                    inputRef,
                    exposeRef,
                    inputValue,
                    exposedData,
                    focusInput,
                    getInputValue,
                    callExposedMethod,
                    getExposedData
                };
            }
        });
        
        app.mount('#app');
    </script>
</body>
</html>